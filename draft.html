<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kimberly's Creative Sprint: A 90-day practice: daily videos, essays, livestreams, and experiments.</title>
    <!-- SEO & Metadata -->
    <meta name="description" content="Join Kimberly's 90-day creative challenge. Outrunning perfectionism one creative entry at a time.">
    <meta name="theme-color" content="#341047">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://knf.kim/90in90">
    <meta property="og:title" content="Kimberly's Creative Sprint - 90 Days of Ideas">
    <meta property="og:description" content="Join Kimberly's 90-day creative challenge. Outrunning perfectionism one creative entry at a time.">
    <meta property="og:image" content="https://knfoster13.github.io/HQ/WARMKDROP6.png">
    <meta property="og:image:alt" content="Kimberly's 90-day Creative Sprint">
    <meta property="og:url" content="https://knf.kim/90in90">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Kimberly's Creative Sprint">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kimberly's Creative Sprint - 90 Days of Ideas">
    <meta name="twitter:description" content="Join Kimberly's 90-day creative challenge. Outrunning perfectionism one creative entry at a time.">
    <meta name="twitter:image" content="https://knfoster13.github.io/HQ/KCS-WARM.png">
    <meta name="twitter:creator" content="@kimberlynfoster">

    <!-- Preload critical assets -->
    <link rel="preload" href="https://knfoster13.github.io/90IN90/images/90in90smallgradient@0.5x.png" as="image">
    <link rel="preload" href="https://knfoster13.github.io/90IN90/images/kmonologcream.png" as="image">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@200;400;500;600;700;800&family=Newsreader:ital,opsz,wght@0,6..72,200;0,6..72,300;1,6..72,200;1,6..72,300&family=Instrument+Serif:ital@0;1&family=DM+Serif+Text&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@200;400;500;600;700;800&family=Newsreader:ital,opsz,wght@0,6..72,200;0,6..72,300;1,6..72,200;1,6..72,300&family=Instrument+Serif:ital@0;1&family=DM+Serif+Text&display=swap"></noscript>

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="css/style.css">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Kimberly's Creative Sprint",
      "description": "90 Days of Ideas",
      "url": "https://knf.kim/90in90",
      "publisher": {
        "@type": "Person",
        "name": "Kimberly Nicole Foster"
      }
    }
    </script>
    <script type="application/ld+json" id="itemListSchema"></script>
</head>
<body class="bg-bg-dark">
    <a href="#content-feed" class="skip-to-content">Skip to content</a>

    <header class="sticky top-0 z-50 frosted-header" role="banner">
        <nav class="max-w-6xl mx-auto px-4 py-4" aria-label="Primary">
            <div class="header-nav flex items-center justify-between">
                <a href="#" class="header-logo flex items-center gap-2" aria-label="Creative Sprint Home">
                    <img src="https://knfoster13.github.io/90IN90/images/lightyellowgradientkmonogram@2x.png" alt="Logo" class="h-10 w-auto">
                    <span class="hidden sm:inline font-medium text-xl tracking-wider" style="color: var(--text-primary);">Kimberly's Creative Sprint</span>
                </a>
    
                <div class="header-counters hidden md:flex flex-col items-center">
                    <div class="flex items-center gap-6 text-center">
                        <div class="flex flex-col">
                            <span id="header-day" class="text-base font-bold">1</span>
                            <span class="text-xs uppercase tracking-wider text-muted">Day</span>
                        </div>
                        <div class="h-6 w-px bg-white/10"></div>
                        <div class="flex flex-col">
                             <span id="header-entries" class="text-base font-bold">0</span>
                             <span class="text-xs uppercase tracking-wider text-muted">Entries</span>
                        </div>
                        <div class="h-6 w-px bg-white/10"></div>
                        <div class="flex flex-col">
                             <span id="header-streak" class="text-base font-bold">0</span>
                             <span class="text-xs uppercase tracking-wider text-muted">Streak</span>
                        </div>
                    </div>
                </div>
    
                <div class="header-buttons flex items-center gap-2">
                    <button id="subscribe-btn" class="btn btn-luminous" aria-label="Join the sprint">
                        <span class="uppercase">Join The Sprint ✦</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8" role="main" id="main-content">
        <section class="text-center pt-12 pb-12 flex flex-col justify-center items-center min-h-[80vh]" aria-labelledby="hero-title">
            <div class="max-w-4xl mx-auto">
                <img src="https://knfoster13.github.io/90IN90/images/90in90smallgradient@0.5x.png" alt="Kimberly's Creative Sprint" class="hero-image mx-auto w-full max-w-2xl mb-8" fetchpriority="high" decoding="async" loading="eager">
                <p class="font-newsreader text-4xl font-light hero-anim-item w-3/4 mx-auto" style="color: var(--text-secondary); transition-delay: 0.4s; letter-spacing: 0.05em;">
                    <i>by</i> Kimberly Nicole <i>Foster</i>
                </p>
                <p id="hero-tagline" class="text-2xl font-medium mt-4 mx-auto uppercase tracking-wider hero-anim-item" style="color: var(--text-secondary); transition-delay: 0.6s;">
                    A 90-Day Sprint Through Ideas, Images, & Inquiry
                </p>
                
                <div class="mt-10 w-full mx-auto hero-anim-item flex flex-col items-center gap-6" style="transition-delay: 0.8s;">
                    <!-- Primary CTA -->
                    <button id="hero-subscribe-btn" class="btn btn-luminous text-xl font-bold uppercase tracking-widest px-10 py-4">Join the Sprint ✦</button>
                
                    <!-- Secondary Links -->
                    <div class="flex items-center justify-center gap-x-8 gap-y-2 flex-wrap mt-4">
                        <button id="newsletter-secondary-btn" class="link-secondary">Newsletter</button>
                        <a href="sms-optin.html" class="link-secondary">SMS Alerts</a>
                        <button id="show-welcome-btn" class="link-secondary">Why?</button>
                    </div>
                </div>

                <strong id="challenge-dates" class="text-2xl font-extralight block mt-8 tracking-widest" style="color: var(--text-secondary);"></strong>
                <div class="w-96 mx-auto mt-8" style="height: 2px; background-color: #CE84EE;"></div>
                 <div id="weekly-theme-container" class="animated-gradient-border inline-block mx-auto mt-8 px-8 py-4" style="background-color: #00ad9b; border-radius: 100px;">
                    <p id="weekly-theme" class="text-2xl" style="color: #FEF8F2;"></p>
                </div>
                <div class="mt-12 text-left max-w-2xl mx-auto">
                    <p class="font-dm-serif-text text-4xl" style="color: #F4E7C8;">Practice over polish. Process over product.</p>
                    <p class="mt-4 text-lg text-text-muted">For ninety days, I’m publishing a map of my mind that forms a constellation of thought around culture, power, and meaning. This project isn't about mastery. It's about momentum. It’s about staying in practice, and (re)building the muscle of inquiry one post at a time.</p>
                </div>
            </div>
        </section>

        <section id="sprint-details" class="text-center fade-in-section max-w-3xl mx-auto hidden">
             <div id="day-dots-container" class="flex gap-1.5 justify-center flex-wrap max-w-full py-2 px-4 mt-8"></div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 max-w-2xl mx-auto" role="region" aria-label="Challenge statistics">
                <div class="card p-4 text-center stat-card"><div class="text-2xl font-semibold text-accent" id="today-count" aria-live="polite">0</div><div class="text-sm text-muted">Today's Entries</div></div>
                <div class="card p-4 text-center stat-card"><div class="text-2xl font-semibold text-cta" id="streak-count" aria-live="polite">0</div><div class="text-sm text-muted">Day Streak</div></div>
                <div class="card p-4 text-center stat-card"><div class="text-2xl font-semibold text-success" id="free-count" aria-live="polite">0</div><div class="text-sm text-muted">Free Content</div></div>
                <div class="card p-4 text-center stat-card"><div class="text-2xl font-semibold text-warning" id="paid-count" aria-live="polite">0</div><div class="text-sm text-muted">Premium</div></div>
            </div>
        </section>

        <section class="mb-6" aria-label="Search, filter and sort entries">
            <div class="card p-4">
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="relative md:col-span-1">
                        <input type="text" id="search-input" class="form-input pl-10" placeholder="Search entries..." aria-label="Search entries">
                        <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                    <div class="flex items-center gap-2 justify-between md:col-span-2">
                        <div class="flex gap-2 flex-wrap" role="group" aria-label="Filter options">
                            <button class="filter-btn active" data-filter="all" aria-pressed="true">All</button>
                            <button class="filter-btn" data-filter="Video" aria-pressed="false">Videos</button>
                            <button class="filter-btn" data-filter="Podcast" aria-pressed="false">Podcasts</button>
                            <button class="filter-btn" data-filter="Essay" aria-pressed="false">Essays</button>
                             <button class="filter-btn" data-filter="Free" aria-pressed="false">Free</button>
                            <button class="filter-btn" data-filter="Paid" aria-pressed="false">Premium</button>
                        </div>
                        <select id="sort-select" class="form-input w-40" aria-label="Sort entries">
                            <option value="newest">Newest</option>
                            <option value="oldest">Oldest</option>
                            <option value="most-loved">❤️ Most Loved</option>
                             <option value="trending">🔥 Trending</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section id="content-feed" class="space-y-8" aria-label="Content feed" aria-busy="true" aria-live="polite">
            <span id="feed-announcer" class="sr-only" aria-live="assertive"></span>
            
            <div id="skeleton-loaders">
                <h2 class="font-semibold mb-4 brand-font animate-pulse">Loading entries...</h2>
                <div class="space-y-6">
                    <div class="skeleton-card"><div class="flex flex-col md:flex-row gap-4"><div class="md:w-48 h-32 skeleton-line rounded-lg"></div><div class="flex-1 space-y-2"><div class="skeleton-line w-3/4"></div><div class="skeleton-line w-1/2"></div><div class="skeleton-line w-full"></div></div></div></div>
                    <div class="skeleton-card"><div class="flex flex-col md:flex-row gap-4"><div class="md:w-48 h-32 skeleton-line rounded-lg"></div><div class="flex-1 space-y-2"><div class="skeleton-line w-3/4"></div><div class="skeleton-line w-1/2"></div><div class="skeleton-line w-full"></div></div></div></div>
                </div>
            </div>
            
            <div id="today-section" class="hidden max-w-4xl mx-auto"><h2 class="font-semibold mb-4 flex items-center gap-3 brand-font">
                <span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span></span>
                <span class="text-white text-gradient">Today's Entries</span>
            </h2><div id="today-entries" class="grid gap-6"></div></div>
            <div id="previous-section" class="hidden max-w-4xl mx-auto">
                <h2 class="font-semibold mb-4 brand-font text-gradient">Previous Entries</h2>
                <div id="previous-entries" class="grid gap-6"></div>
                <div id="load-more-container" class="text-center mt-8"></div>
            </div>
            
            <div id="empty-state" class="text-center py-12 hidden"><svg class="w-24 h-24 mx-auto mb-4 text-muted opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg><p class="text-lg text-muted" id="empty-state-message">No entries yet. Check back soon!</p></div>
        </section>
        
        <nav class="mt-12" aria-label="Quick links">
            <h2 class="font-semibold mb-6 text-center brand-font text-gradient">Quick Links</h2>
            <div class="grid grid-cols-1 md-grid-cols-3 gap-4 max-w-3xl mx-auto">
                <a href="https://www.patreon.com/kimberlynfoster" class="card p-6 flex items-center gap-4 hover:!scale-105" rel="noopener noreferrer" target="_blank">
                    <div class="p-3 rounded-full bg-pink-500/20"><svg class="w-6 h-6 text-pink-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/></svg></div>
                    <span class="font-medium">Support on Patreon</span>
                </a>
                <a href="sms-optin.html" class="card p-6 flex items-center gap-4 hover:!scale-105">
                    <div class="p-3 rounded-full bg-blue-500/20"><svg class="w-6 h-6 text-blue-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path d="M3.5 2A1.5 1.5 0 0 0 2 3.5v9A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 12.5 2h-9zM3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-9z"/><path d="M5.5 7a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/></svg></div>
                    <span class="font-medium">Get Text Alerts</span>
                </a>
                <a href="https://kimberlynfoster.substack.com" class="card p-6 flex items-center gap-4 hover:!scale-105" rel="noopener noreferrer" target="_blank">
                    <div class="p-3 rounded-full bg-green-500/20"><svg class="w-6 h-6 text-green-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg></div>
                    <span class="font-medium">Newsletter</span>
                </a>
            </div>
        </nav>
    </main>

    <footer class="text-center py-8 mt-12 text-sm text-muted" role="contentinfo">
        <div class="flex justify-center gap-2 mb-4">
            <a href="admin.html" class="btn btn-secondary !bg-transparent !text-sm !p-2" title="Admin sign in" aria-label="Admin sign in">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true"><path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14l1.5 1.5L14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>
            </a>
        </div>
        <p>&copy; 2025 Kimberly's Creative Sprint. All rights reserved.</p>
    </footer>

    <div id="welcome-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden flex items-center justify-center p-4 z-50" role="dialog" aria-labelledby="welcome-modal-title" aria-modal="true">
        <div class="card p-8 relative max-w-2xl w-full">
            <button id="close-welcome-modal" class="absolute top-4 right-4 text-muted hover:text-primary transition-colors" aria-label="Close modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            <h2 id="welcome-modal-title" class="font-semibold mb-6 brand-font text-gradient text-center">What is the Creative Sprint?</h2>
            <p class="text-lg text-text-secondary mb-4 mx-auto italic">
                For the next 90 days, I'm throwing myself into an experiment in making. The Creative Sprint isn't about perfection or polish, it's about rhythm and rigor. Each week I'll take on a theme—pop culture, politics, or the messy intersections of gender, race, capitalism, and art—and build a body of work around it. Videos, essays, livestreams, podcasts, posts—each orbiting the same core questions, each in conversation with the others.
            </p>
            <p class="text-lg text-text-secondary mb-4 mx-auto">
                You'll be able to trace the references, inspirations, and footnotes in real time. Not just what I think—but how I think.
            </p>
            <p class="text-xl font-semibold text-gradient my-6 italic text-center mx-auto">
                This is practice, but also proof: ambitious ideas deserve ambitious output.
            </p>
            <p class="text-lg text-text-secondary mb-4 mx-auto">
                By the end of 90 days, I'll have more than a stack of work: I'll have a living archive—a record of the thinkers, artists, and texts I've been in dialogue with, and a map of where my ideas might go next.
            </p>
             <p class="text-lg text-text-secondary mb-4 mx-auto">
                This isn't about chasing an algorithm. This is about giving creativity structure and space to breathe—and seeing what happens.
            </p>
            <p class="text-lg text-text-secondary mx-auto">
                The Sprint is an invitation: to run toward the work instead of away from it.
            </p>
            <img src="https://knfoster13.github.io/HQ/KNFSIGNATURE.png" alt="Kimberly's signature" class="mx-auto mt-8 w-48" loading="lazy">
        </div>
    </div>

    <div id="subscribe-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden flex items-center justify-center p-4 z-50" role="dialog" aria-labelledby="subscribe-modal-title" aria-modal="true">
        <div class="card p-6 relative max-w-lg w-full">
            <button id="close-subscribe" class="absolute top-4 right-4 text-muted hover:text-primary transition-colors" aria-label="Close modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            <h2 id="subscribe-modal-title" class="font-semibold mb-4 text-center brand-font text-gradient">Join the Newsletter!</h2>
            <p class="text-muted mb-6 text-center mx-auto">Get exclusive updates, behind-the-scenes content, and early access to entries straight to your inbox!</p>
            <div class="bg-white rounded-xl p-1"><iframe src="https://kimberlynfoster.substack.com/embed" width="100%" height="320" style="border:1px solid #EEE; background:white;" frameborder="0" scrolling="no" title="Subscribe to newsletter"></iframe></div>
        </div>
    </div>

    <div id="sms-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden flex items-center justify-center p-4 z-50" role="dialog" aria-labelledby="sms-modal-title" aria-modal="true">
        <div class="card p-8 relative max-w-lg w-full">
            <button id="close-sms-modal" class="absolute top-4 right-4 text-muted hover:text-primary transition-colors" aria-label="Close SMS modal"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            <h2 id="sms-modal-title" class="font-semibold mb-2 text-center brand-font text-gradient">Get SMS Alerts</h2>
            <p class="text-muted mb-6 text-center mx-auto">Be the first to know when new entries go live, get reminders, and receive exclusive tips.</p>
            <div class="tm-widget-container">
                <script src="https://widgets.textmagic.com/widget-script.js" data-code="ca975eb0fab8d2e" data-type="subscribe" defer></script>
            </div>
        </div>
    </div>

    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <script type="module" defer>
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, where, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { firebaseConfig } from 'js/firebase-config.js';

        // --- CONFIGURATION ---
        const START_DATE = new Date('2025-10-13T00:00:00');
        const TOTAL_DAYS = 90;
        const END_DATE = new Date(START_DATE.getTime() + (TOTAL_DAYS * 24 * 60 * 60 * 1000));
        const MS_PER_DAY = 1000 * 60 * 60 * 24;
        const ENTRIES_PER_PAGE = 5;
        const dropsCollectionPath = `artifacts/${firebaseConfig.projectId}/public/data/drops`;
        
        // --- UTILITY FUNCTIONS ---
        const getCurrentDay = () => {
            const now = new Date();
            if (now < START_DATE) return 0;
            if (now > END_DATE) return TOTAL_DAYS;
            const startOfDay = d => { const date = new Date(d); date.setHours(0,0,0,0); return date; };
            return Math.floor((startOfDay(now) - startOfDay(START_DATE)) / MS_PER_DAY) + 1;
        };
        const escapeHtml = str => str ? new DOMParser().parseFromString(str, 'text/html').body.textContent : '';
        const toJsDate = v => v?.toDate ? v.toDate() : new Date(v);
        const debounce = (func, wait) => {
            let timeout;
            return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), wait); };
        };

        // --- GLOBAL STATE ---
        const state = {
            allEntries: [],
            filteredEntries: [],
            currentFilter: 'all',
            currentSort: 'newest',
            searchQuery: '',
            heartedPosts: JSON.parse(localStorage.getItem('heartedPosts') || '{}'),
            visiblePreviousEntries: ENTRIES_PER_PAGE,
        };

        // --- DOM ELEMENTS ---
        const DOMElements = Object.fromEntries(
            [
                'header-day', 'header-entries', 'today-count', 'streak-count', 'header-streak',
                'free-count', 'paid-count', 'challenge-dates', 'search-input',
                'sort-select', 'skeleton-loaders', 'today-section', 'today-entries', 'previous-section', 'previous-entries',
                'load-more-container', 'empty-state', 'empty-state-message', 'subscribe-btn', 'hero-subscribe-btn',
                'subscribe-modal', 'close-subscribe', 'sms-modal', 'close-sms-modal', 'toast', 
                'content-feed', 'day-dots-container', 'feed-announcer',
                'welcome-modal', 'show-welcome-btn', 'close-welcome-modal', 'weekly-theme', 'newsletter-secondary-btn'
            ].map(id => [id.replace(/-(\w)/g, (m, g) => g.toUpperCase()), document.getElementById(id)])
        );
        
        const weeklyThemes = [
            "Narratives, Myths & Lies",
            "Digital Selves & Authenticity",
            "The Aesthetics of Power",
            "Creator Economy & The Future of Work",
            "Black Feminist Thought in a Digital Age",
            "Nostalgia, Trends, and the Cultural Cycle",
            "Visual Storytelling & Online Identity",
            "The Art of the Critique",
            "Building Community in Public",
            "Rest, Leisure, and Liberatory Practice",
            "Money, Ambition, and Creative Integrity",
            "The Algorithm & The Archive",
            "Reflections & Future Forecasts"
        ];
        
        // --- RENDER & UI ---
        const updateWeeklyTheme = () => {
            const now = new Date();
            
            if (!DOMElements.weeklyTheme) return;
            
            if (now < START_DATE) {
                const daysUntilStart = Math.ceil((START_DATE - now) / MS_PER_DAY);
                let startMessage = `Sprint Starts in ${daysUntilStart} days!`;
                if (daysUntilStart === 1) startMessage = `Sprint Starts Tomorrow!`;
                else if (daysUntilStart <= 0) startMessage = `Sprint Starts Today!`;
                DOMElements.weeklyTheme.innerHTML = `<strong class="font-bold">${startMessage}</strong> First theme: ${weeklyThemes[0]}`;
                DOMElements.weeklyTheme.parentElement.style.display = 'inline-block';
                return;
            }
            
            if (now > END_DATE) {
                DOMElements.weeklyTheme.parentElement.style.display = 'none';
                return;
            }
            
            const daysIntoSprint = Math.floor((now - START_DATE) / MS_PER_DAY);
            const weekNumber = Math.floor(daysIntoSprint / 7);

            let themeText = "Reflections & Future Forecasts";
            if (weekNumber >= 0 && weekNumber < weeklyThemes.length) {
                themeText = weeklyThemes[weekNumber];
            }
            DOMElements.weeklyTheme.innerHTML = `<strong class="font-bold">This Week's Theme:</strong> ${themeText}`;
            DOMElements.weeklyTheme.parentElement.style.display = 'inline-block';
        };

        const updateProgress = () => {
            const day = getCurrentDay();
            if (DOMElements.headerDay) DOMElements.headerDay.textContent = day;
        };

        const createEntryCard = (entry, scrollObserver) => {
            const isHearted = state.heartedPosts[entry.id];
            const entryDate = toJsDate(entry.timestamp);
            const time = entryDate.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
            const fallbackImage = `https://knfoster13.github.io/90IN90/images/90in90transparent40glow.png`;
            const imageUrl = entry.imageUrl || fallbackImage;

            const card = document.createElement('div');
            card.className = 'card flex flex-col md:flex-row relative';
            card.dataset.id = entry.id;
            card.dataset.contentType = entry.contentType;
            
            card.innerHTML = `
                <div class="md:w-48 aspect-[4/3] flex-shrink-0 image-container relative">
                    <img src="${escapeHtml(imageUrl)}" alt="${escapeHtml(entry.title)}" class="w-full h-full object-cover" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='${fallbackImage}';">
                </div>
                <div class="flex-1 p-4 md:p-5 flex flex-col">
                    <span class="tag ${entry.access === 'Paid' ? 'tag-paid' : 'tag-free'} absolute top-3 right-3">${entry.access}</span>
                    <div class="flex-grow space-y-2 mt-4">
                        <h3 class="font-medium leading-tight hover:text-accent transition-colors">
                          <a href="${entry.link}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5">${escapeHtml(entry.title)} <svg class="w-4 h-4 opacity-50 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg></a>
                        </h3>
                        <p class="text-base text-muted line-clamp-3" style="line-height: 1.5;">${escapeHtml(entry.description)}</p>
                    </div>
                     <p class="text-xs text-muted mt-4">Day ${entry.day} • ${entry.contentType} • ${time}</p>
                    <div class="flex items-center gap-3 mt-4 pt-3 border-t border-white/10">
                         <button class="heart-btn flex items-center gap-1.5 ${isHearted ? 'text-heart hearted' : 'text-muted hover:text-heart'}" data-id="${entry.id}" aria-label="${isHearted ? 'Remove heart' : 'Add heart'} from ${escapeHtml(entry.title)}">
                            <svg class="w-5 h-5" fill="${isHearted ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.25l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.5l-1.318-1.182a4.5 4.5 0 00-6.364 0z"></path></svg>
                            <span class="font-mono text-sm">${entry.hearts || 0}</span>
                        </button>
                        <button class="share-btn text-sm text-muted hover:text-primary ml-2" data-link="${escapeHtml(entry.link)}" data-title="${escapeHtml(entry.title)}">
                            Share
                        </button>
                    </div>
                </div>
            `;
            scrollObserver.observe(card);
            return card;
        };
        
        const renderEntries = (scrollObserver) => {
            DOMElements.skeletonLoaders.classList.add('hidden');
            DOMElements.contentFeed.setAttribute('aria-busy', 'false');

            const day = getCurrentDay();
            const todayEntries = state.filteredEntries.filter(d => d.day === day);
            const previousEntries = state.filteredEntries.filter(d => d.day < day);
            
            const publishedEntriesCount = state.allEntries.length;
            
            DOMElements.headerEntries.textContent = publishedEntriesCount;
            DOMElements.todayCount.textContent = todayEntries.length;
            DOMElements.freeCount.textContent = state.allEntries.filter(d => d.access === 'Free').length;
            DOMElements.paidCount.textContent = state.allEntries.filter(d => d.access === 'Paid').length;
            const daysWithEntries = new Set(state.allEntries.map(d => d.day)).size;
            DOMElements.streakCount.textContent = daysWithEntries;
            DOMElements.headerStreak.textContent = daysWithEntries;

            DOMElements.todaySection.classList.toggle('hidden', todayEntries.length === 0);
            DOMElements.todayEntries.innerHTML = '';
            todayEntries.forEach(d => DOMElements.todayEntries.appendChild(createEntryCard(d, scrollObserver)));

            const previousToShow = previousEntries.slice(0, state.visiblePreviousEntries);
            DOMElements.previousSection.classList.toggle('hidden', previousToShow.length === 0);
            DOMElements.previousEntries.innerHTML = '';
            previousToShow.forEach(d => DOMElements.previousEntries.appendChild(createEntryCard(d, scrollObserver)));
            
            DOMElements.loadMoreContainer.innerHTML = ''; 
            if (previousEntries.length > state.visiblePreviousEntries) {
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.textContent = 'Load More Entries';
                loadMoreBtn.className = 'btn btn-secondary';
                loadMoreBtn.onclick = () => {
                    state.visiblePreviousEntries += ENTRIES_PER_PAGE;
                    renderEntries(scrollObserver);
                };
                DOMElements.loadMoreContainer.appendChild(loadMoreBtn);
            }

            if (state.filteredEntries.length === 0 && todayEntries.length === 0) {
                DOMElements.emptyState.classList.remove('hidden');
                DOMElements.emptyStateMessage.textContent = (state.searchQuery || state.currentFilter !== 'all') ? 'No entries found.' : 'No entries yet.';
            } else {
                DOMElements.emptyState.classList.add('hidden');
            }
        };
        
        const applyFiltersAndSort = (scrollObserver) => {
            state.visiblePreviousEntries = ENTRIES_PER_PAGE;
            state.filteredEntries = state.allEntries.filter(entry => {
                const search = state.searchQuery.toLowerCase();
                const matchesSearch = !search || entry.title.toLowerCase().includes(search) || entry.description.toLowerCase().includes(search);
                const matchesFilter = state.currentFilter === 'all' || (['Free', 'Paid'].includes(state.currentFilter) ? entry.access === state.currentFilter : entry.contentType === state.currentFilter);
                return matchesSearch && matchesFilter;
            });

            state.filteredEntries.sort((a, b) => {
                const timeA = a.timestamp?.toMillis() || 0;
                const timeB = b.timestamp?.toMillis() || 0;
                switch (state.currentSort) {
                    case 'oldest': return timeA - timeB;
                    case 'most-loved': return (b.hearts || 0) - (a.hearts || 0);
                    default: return timeB - timeA;
                }
            });
            renderEntries(scrollObserver);
        };
        
        // --- EVENT LISTENERS & INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            const scrollObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); });
            }, { threshold: 0.1 });
            
            onAuthStateChanged(auth, async (user) => {
                if (!user) await signInAnonymously(auth);

                const q = query(collection(db, dropsCollectionPath), where('status', '==', 'published'));
                onSnapshot(q, (snapshot) => {
                    state.allEntries = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    applyFiltersAndSort(scrollObserver);
                });
            });
            
            const endDate = new Date(START_DATE.getTime() + (TOTAL_DAYS - 1) * MS_PER_DAY);
            DOMElements.challengeDates.innerHTML = `${START_DATE.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })} &mdash; ${endDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
            updateProgress();
            updateWeeklyTheme();
            setInterval(updateProgress, 60000);
            setInterval(updateWeeklyTheme, 60000 * 60);

            const setupModal = (modal, openBtns, closeBtn) => {
                const openModal = () => modal?.classList.remove('hidden');
                const closeModal = () => modal?.classList.add('hidden');
                openBtns.forEach(btn => btn?.addEventListener('click', openModal));
                closeBtn?.addEventListener('click', closeModal);
                modal?.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
            };
            
            setupModal(DOMElements.welcomeModal, [DOMElements.showWelcomeBtn], DOMElements.closeWelcomeModal);
            setupModal(DOMElements.subscribeModal, [DOMElements.subscribeBtn, DOMElements.heroSubscribeBtn, DOMElements.newsletterSecondaryBtn], DOMElements.closeSubscribe);

            DOMElements.searchInput?.addEventListener('input', debounce((e) => {
                state.searchQuery = e.target.value;
                applyFiltersAndSort(scrollObserver);
            }, 300));
            DOMElements.sortSelect?.addEventListener('change', (e) => {
                state.currentSort = e.target.value;
                applyFiltersAndSort(scrollObserver);
            });
            document.querySelectorAll('.filter-btn').forEach(btn => btn.addEventListener('click', (e) => {
                document.querySelector('.filter-btn.active').classList.remove('active');
                e.currentTarget.classList.add('active');
                state.currentFilter = e.currentTarget.dataset.filter;
                applyFiltersAndSort(scrollObserver);
            }));

            DOMElements.contentFeed.addEventListener('click', async (e) => {
                const btn = e.target.closest('.heart-btn');
                if (btn && !btn.classList.contains('hearted')) {
                     const id = btn.dataset.id;
                     state.heartedPosts[id] = true;
                     localStorage.setItem('heartedPosts', JSON.stringify(state.heartedPosts));
                     btn.classList.add('text-heart', 'hearted');
                     const heartCountSpan = btn.querySelector('span');
                     heartCountSpan.textContent = parseInt(heartCountSpan.textContent, 10) + 1;
                     await updateDoc(doc(db, dropsCollectionPath, id), { hearts: increment(1) });
                }
            });
        });
    </script>
</body>
</html>


